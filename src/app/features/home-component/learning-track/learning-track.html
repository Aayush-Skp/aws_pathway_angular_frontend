<div class="learning-track-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Learning Track</h2>
            <p class="subtitle">AWS Pathway</p>
        </div>

        <nav class="navigation">
            <!-- Category Level -->
            <div *ngFor="let category of categories; trackBy: trackByPath" class="category-section">
                <div class="category-header" (click)="toggleItem(category, 'category')"
                    [class.active]="category.isExpanded">
                    <span class="expand-icon" *ngIf="!category.isLoading">
                        {{ category.isExpanded ? 'â–¼' : 'â–¶' }}
                    </span>
                    <span class="loading-spinner" *ngIf="category.isLoading">âŸ³</span>
                    <span class="category-name">{{ getItemName(category) }}</span>
                </div>

                <!-- Chapter Level -->
                <div class="chapters" *ngIf="category.isExpanded && category.children">
                    <div *ngFor="let chapter of category.children; trackBy: trackByPath" class="chapter-section">
                        <div class="chapter-header" (click)="toggleItem(chapter, 'chapter')"
                            [class.active]="chapter.isExpanded">
                            <span class="expand-icon" *ngIf="!chapter.isLoading">
                                {{ chapter.isExpanded ? 'â–¼' : 'â–¶' }}
                            </span>
                            <span class="loading-spinner" *ngIf="chapter.isLoading">âŸ³</span>
                            <span class="chapter-name">{{ getItemName(chapter) }}</span>
                        </div>

                        <!-- Topic/Subtopic Level (Recursive) -->
                        <div class="topics" *ngIf="chapter.isExpanded && chapter.children">
                            <ng-container *ngTemplateOutlet="topicTree; context: { items: chapter.children, depth: 1 }">
                            </ng-container>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </aside>

    <!-- Content Area -->
    <main class="content-area">
        <div *ngIf="!selectedFile && !isLoadingContent" class="welcome-screen">
            <div class="welcome-content">
                <h1>Welcome to AWS Learning Track</h1>
                <p>Select a topic from the sidebar to begin your learning journey</p>
                <div class="features">
                    <div class="feature-card">
                        <span class="feature-icon">ðŸ“š</span>
                        <h3>Structured Learning</h3>
                        <p>Progress from beginner to advanced levels</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">ðŸŽ¯</span>
                        <h3>Hands-on Practice</h3>
                        <p>Real-world examples and exercises</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">ðŸš€</span>
                        <h3>Career Ready</h3>
                        <p>Prepare for AWS certification exams</p>
                    </div>
                </div>
            </div>
        </div>

        <div *ngIf="isLoadingContent" class="loading-screen">
            <div class="loader"></div>
            <p>Loading content...</p>
        </div>

        <div *ngIf="selectedFile && !isLoadingContent" class="topic-content">
            <div class="content-header">
                <h1>{{ getItemName(selectedFile) }}</h1>
                <p class="breadcrumb">{{ selectedFile.path }}</p>
            </div>
            <div class="content-wrapper" [innerHTML]="fileContent"></div>
        </div>
    </main>
</div>

<!-- Recursive Template for nested topics -->
<ng-template #topicTree let-items="items" let-depth="depth">
    <div *ngFor="let item of items; trackBy: trackByPath" class="topic-item" [class.selected]="isFileSelected(item)"
        [style.padding-left.rem]="2 + depth">
        <div class="topic-content-wrapper" (click)="toggleItem(item, 'topic')">
            <span class="expand-icon" *ngIf="item.is_directory && !item.isLoading">
                {{ item.isExpanded ? 'â–¼' : 'â–¶' }}
            </span>
            <span class="loading-spinner" *ngIf="item.isLoading">âŸ³</span>
            <span class="topic-dot" *ngIf="!item.is_directory">â€¢</span>
            <span class="topic-name">{{ getItemName(item) }}</span>
        </div>

        <!-- Recursive call for nested items -->
        <div *ngIf="item.isExpanded && item.children && item.children.length > 0">
            <ng-container *ngTemplateOutlet="topicTree; context: { items: item.children, depth: depth + 1 }">
            </ng-container>
        </div>
    </div>
</ng-template>